<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PC Simulator Coins Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      color: white;
      background: url('https://i.ibb.co/TDm9ZPh8/Sans-titre-70-20250831171949.jpg') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }
    .wrapper { display: flex; gap: 24px; width: 100%; max-width: 1200px; padding: 24px; }
    #leaderboard {
      background: rgba(0,0,0,0.6);
      padding: 20px;
      border-radius: 12px;
      min-width: 260px;
      max-width: 320px;
      max-height: calc(100vh - 48px);
      overflow-y: auto;
    }
    #leaderboard h2 { margin-top: 0; }
    .container {
      flex: 1;
      background: rgba(0,0,0,0.28);
      border-radius: 16px;
      padding: 28px 20px 36px;
      text-align: center;
      position: relative;
    }
    h1 {
      font-size: 46px;
      margin: 6px 0 26px;
      color: #fff;
      -webkit-text-stroke: 2px #000;
    }
    #localCoins { font-size: 42px; font-weight: bold; margin-top: 24px; color: #ffd700; text-shadow: 2px 2px 6px #000; }
    #totalCoins { margin-top: 8px; font-size: 18px; color: #00dd00; text-shadow: 1px 1px 3px #000; }
    input[type="text"], input[type="password"] {
      font-size: 18px;
      padding: 12px 14px;
      border-radius: 10px;
      border: none;
      outline: none;
      width: min(520px, 90%);
      margin-top: 10px;
    }
    button {
      font-size: 22px;
      padding: 12px 24px;
      margin: 10px 6px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      background-color: #4caf50;
      color: #fff;
      box-shadow: 0 6px 14px rgba(0,0,0,0.45);
    }
    #earnBtn {
      width: 200px;       
      height: 100px;       
      margin-top: 24px;       
      background-color: #00ff00;       
      color: #000;       
      border-radius: 10px;       
      box-shadow: 0 4px 8px rgba(0,0,0,0.6);       
      border: none;       
      outline: none;       
      user-select: none;       
      cursor: pointer;
    }
    #earnBtn:active { background: #c9a92f; }
    ol { padding-left: 0; list-style: decimal inside; text-align: left; margin: 12px 0 0; }
    ol li {
      background: rgba(255,255,255,0.12);
      margin: 6px 0;
      padding: 10px 14px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08);
    }
    .rank-1 { background: #ffd700 !important; color: #000; font-weight: bold; }
    .rank-2 { background: #c0c0c0 !important; color: #000; font-weight: bold; }
    .rank-3 { background: #cd7f32 !important; color: #fff; font-weight: bold; }
    #logoutBtn {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 16px;
      background: none;
      color: #fff;
      text-decoration: underline;
      cursor: pointer;
      border: none;
      padding: 0;
      box-shadow: none;
    }
    @media (max-width: 900px) {
      .wrapper { flex-direction: column; align-items: center; }
      .container { order: 1; width: 92%; }
      #leaderboard { order: 2; margin-top: 20px; width: 92%; max-width: 560px; max-height: unset; }
      h1 { font-size: 36px; -webkit-text-stroke: 1.6px #000; }
      #earnBtn { font-size: 26px; padding: 26px 48px; }
      #localCoins { font-size: 34px; }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <main class="container">
      <button id="logoutBtn" style="display:none;">Logout</button>
      <h1>üî• PC Simulator Coins Game üî•</h1>

      <!-- Auth UI -->
      <div id="authUI">
        <button id="showLogin">Login</button>
        <button id="showRegister">Register</button>
        <div id="loginForm" style="display:none;">
          <input type="text" id="loginName" placeholder="Nickname" />
          <input type="password" id="loginPass" placeholder="Password" />
          <button id="loginBtn">Login</button>
        </div>
        <div id="registerForm" style="display:none;">
          <input type="text" id="regName" placeholder="Choose Nickname" />
          <input type="password" id="regPass" placeholder="Choose Password" />
          <button id="registerBtn">Register</button>
        </div>
      </div>

      <!-- Game UI -->
      <div id="gameUI" style="display:none;">
        <button id="earnBtn">EARN</button>
        <div id="localCoins">üí∞ PC Simulator Coins: 0</div>
        <div id="totalCoins">Your Total Score: 0</div>
      </div>
    </main>

    <aside id="leaderboard">
      <h2>üèÜ Leaderboard</h2>
      <ol id="leaderboardList"></ol>
    </aside>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, get, set, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD_cipEXGL0uOlMsqvzsK4jDHzTHB6iG9k",
      authDomain: "pc-simulator-coins-game-1fc13.firebaseapp.com",
      databaseURL: "https://pc-simulator-coins-game-1fc13-default-rtdb.firebaseio.com",
      projectId: "pc-simulator-coins-game-1fc13",
      storageBucket: "pc-simulator-coins-game-1fc13.appspot.com",
      messagingSenderId: "424767393111",
      appId: "1:424767393111:web:37bdc0031d413a1b908212",
      measurementId: "G-5ZBJTR620J"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Easter Eggs
    const easterEggs = {
      "cornet": { coins: 100, message: "Free Cornet!" },
      "nigga": { coins: -100, message: "You racist madafaka" },
      "john": { coins: 200, message: "Have you gotten soft 47?" },
      "47": { coins: 200, message: "Have you gotten soft 47?" },
      "agent47": { coins: 200, message: "Have you gotten soft 47?" },
      "yaming": { coins: 0, message: "Are you the real one?" },
      "sandwich": { coins: 300, message: "FUCK BURGERS" },
      "yamimg": { coins: 300, message: "FUCK BURGERS" },
      "sabisa": { coins: 1, message: "Free Sabisa" },
      "nobody": { coins: 0, message: "Who are you?" },
      "goobie": { coins: 0, message: "More like Goonie" }
    };

    function checkEasterEgg(nickname, userRef, userObj) {
      const key = nickname.toLowerCase();
      if (easterEggs[key]) {
        const egg = easterEggs[key];
        if (egg.coins !== 0) {
          userObj.totalScore += egg.coins;
          update(userRef, { totalScore: userObj.totalScore });
        }
        alert(egg.message);
      }
    }

    // Elements
    const authUI = document.getElementById("authUI");
    const gameUI = document.getElementById("gameUI");
    const logoutBtn = document.getElementById("logoutBtn");
    const earnBtn = document.getElementById("earnBtn");
    const localCoinsEl = document.getElementById("localCoins");
    const totalCoinsEl = document.getElementById("totalCoins");
    const leaderboardList = document.getElementById("leaderboardList");

    const showLogin = document.getElementById("showLogin");
    const showRegister = document.getElementById("showRegister");
    const loginForm = document.getElementById("loginForm");
    const registerForm = document.getElementById("registerForm");
    const loginBtn = document.getElementById("loginBtn");
    const registerBtn = document.getElementById("registerBtn");

    let currentUser = null;
    let sessionScore = 0;
    let pendingCoins = 0;

    // Leaderboard live update
    const usersRef = ref(db, "users");
    onValue(usersRef, (snapshot) => {
      const data = snapshot.val() || {};
      const users = Object.values(data).sort((a,b)=>(b.totalScore||0)-(a.totalScore||0)).slice(0,10);
      leaderboardList.innerHTML = "";
      users.forEach((u,i)=>{
        const li = document.createElement("li");
        if (i===0) li.classList.add("rank-1");
        else if (i===1) li.classList.add("rank-2");
        else if (i===2) li.classList.add("rank-3");
        li.textContent = `${u.nickname}: ${u.totalScore || 0}`;
        leaderboardList.appendChild(li);
      });
    });

    function updateCounters() {
      localCoinsEl.textContent = "üí∞ PC Simulator Coins: " + sessionScore;
      totalCoinsEl.textContent = "Your Total Score: " + (currentUser?.totalScore || 0);
    }

    async function safeUpdateCoins() {
      if (!currentUser) return;
      const nameKey = currentUser.nickname.toLowerCase();
      const userRef = ref(db, "users/" + nameKey);
      const snap = await get(userRef);
      if (!snap.exists()) return;
      const dbUser = snap.val();
      dbUser.totalScore += pendingCoins;
      pendingCoins = 0;
      currentUser.totalScore = dbUser.totalScore;
      await update(userRef, { totalScore: dbUser.totalScore });
      updateCounters();
    }

    earnBtn.addEventListener("click", () => {
      if (!currentUser) return;
      sessionScore += 5;
      pendingCoins += 5;
      currentUser.totalScore += 5;
      updateCounters();
      safeUpdateCoins();
    });

    // Auth
    showLogin.onclick = ()=>{ loginForm.style.display="block"; registerForm.style.display="none"; };
    showRegister.onclick = ()=>{ registerForm.style.display="block"; loginForm.style.display="none"; };

    registerBtn.onclick = async () => {
      const name = document.getElementById("regName").value.trim();
      const pass = document.getElementById("regPass").value.trim();
      if (!name || !pass) { alert("Enter nickname and password"); return; }

      const userRef = ref(db, "users/" + name.toLowerCase());
      const snap = await get(userRef);
      if (snap.exists()) { alert("Nickname already taken"); return; }

      const newUser = { nickname: name, password: pass, totalScore: 0 };
      await set(userRef, newUser);

      // Easter Egg check
      checkEasterEgg(name, userRef, newUser);

      localStorage.setItem("user", JSON.stringify(newUser));
      currentUser = newUser;
      authUI.style.display="none";
      gameUI.style.display="block";
      logoutBtn.style.display="block";
      updateCounters();
    };

    loginBtn.onclick = async () => {
      const name = document.getElementById("loginName").value.trim();
      const pass = document.getElementById("loginPass").value.trim();
      if (!name || !pass) { alert("Enter nickname and password"); return; }

      const userRef = ref(db, "users/" + name.toLowerCase());
      const snap = await get(userRef);
      if (!snap.exists()) { alert("User not found"); return; }
      const dbUser = snap.val();
      if (dbUser.password !== pass) { alert("Wrong password"); return; }

      currentUser = dbUser;
      localStorage.setItem("user", JSON.stringify(dbUser));
      authUI.style.display="none";
      gameUI.style.display="block";
      logoutBtn.style.display="block";
      updateCounters();
    };

    logoutBtn.onclick = () => {
      localStorage.removeItem("user");
      currentUser = null;
      sessionScore = 0;
      authUI.style.display="block";
      gameUI.style.display="none";
      logoutBtn.style.display="none";
    };

    // Auto login
    window.addEventListener("load", async ()=>{
      const saved = localStorage.getItem("user");
      if (saved) {
        const u = JSON.parse(saved);
        const userRef = ref(db, "users/" + u.nickname.toLowerCase());
        const snap = await get(userRef);
        if (snap.exists() && snap.val().password === u.password) {
          currentUser = snap.val();
          authUI.style.display="none";
          gameUI.style.display="block";
          logoutBtn.style.display="block";
          updateCounters();
        } else {
          localStorage.removeItem("user");
        }
      }
    });
  </script>
</body>
</html>
